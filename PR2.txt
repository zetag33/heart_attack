1. Descripció del dataset.

El dataset és important ja que conté dades reals de pacients i si aquests han tingut o no un atac de cor, 
les malalties cardiovasculars són la primera
causa de mort al món, per tant poder tindre informació estructurada i real d'aquesta problemàtica per tal de poder-la
estudiar és de vital importancia.

El dataset pretén respondre o donar els mitjans per tal de respondre la pregunta de com es relaciona el fet de tindre
o no un atac de cor amb les diferents característiques associades al pacient.

El nombre de característiques rellevants o que tenen alguna mena de rellevancia sobre si una persona tindra un atac de cor o no
pot ser molt gran i segur que s'ens escapen característiques que influencien de certa manera l'outcome, però el dataset
recull les esencials i necesaries per tal de tindre una explicabilitat alta amb un nombre de features reduït.

La funció que explica la relació entre un atac de cor i les característiques d'una persona a la realitat tindrà en compte
moltes variables i moltes dimensions, per tal d'aproximar-la fem servir aquestes característiques seleccionades
ja que són les que major explicabilitat ens aporten.

2. Integració i selecció de les dades d'interès.

Aquest pas es díficil de realitzar per aquest dataset, ja que és un dataset ja preseleccionat importancia
la integració ja està feta, tenim 303 observacions las quals no són moltes, l'únic motiu pel qual podriem
excloure variables es per que aquestes no siguin significatives a l'hora de predir l'outcome però en aquest cas
això encara no ho podem saber i ho sabrem quan realitzem la creació d'un model i realitzem inferència.

Com a resum, degut a que el dataset és un dataset net i preparat especificament per tal de poder realitzar
tasques de ML amb ell, no requereix d'integració ni de fer una selecció sobre les dades originals
ja que aquestes són valides, contenen una volumetria acceptable, les features en principi hauriem de ser relevants
i no n'hi ha en excés.

Per tant poder l'únic procés que aplicaria per aquest apartat és aillar el target.

3. Neteja de les dades.

El dataset no conté NaN's, com he dit anteriorment el dataset que ens ofereix l'enunciat ja ha sigut netejat i preprocessat amb anterioritat per l'autor per tal
de fer-lo un dataset de pràctica per altre gent. Tampoc conté 0 sense sentit que puguin ser interpretats com a NaN's.
Al codi faig una definició de cada variable i represento un boxplot en cas de que la variable sigui continua o un barplot si es categorica.
Detectem 20 outliers en total, dels quals 19 són registres "distincts", tenint en compte que representen un 6.25% de la volumetría del dataset i que no tinc
el coneixement tècnic suficient per poder jutjar que aquests valors poden tindre sentit decideixo eliminar-los.
Podia haver sustituit els valors outliers per alguna constant estadística de la variable en el registre en concret, però trobo millor donada la volumetría
i veient en els boxplots que algun d'aquest valor s'en va molt del rang normal que es millor simplement eliminar-los.
També podia comprimir tots els valors de la columna per tal d'intentar eliminar els outliers o reduirlos, mitjançant alguna funció del tipus log, però trobo més pràctic i lògic, eliminar els registres.
Deixo una breu descripció de cada variable que també incloc al codi:

	Age: edat del pacient
	Sex: sexe del pacient
	cp: tipus de dolor de pit
	trtbps: pressió sanguinia en repos en mm
	chol: colesterol en mg/dl
	fbs: sucre en sang en dejú, > 120 mg/dl = 1 else 0
	restecg: resultats electrocardiografics en repos. Categories
	thalachh: major tasa de batecs assolida
	exang: atac produit per exercici físic? 1 o 0.
	oldpeak: major tasa de batecs assolida anteriorment
	slp: pendent de la pujada de la tasa de batecs
	ca: número d'arteries afectades.
	thall: malaltia de la sang, categorica, tipus de malaltia.


4. Ànalisi de les dades.

4.1.
Si hi ha dos grups que volem comparar, evidentment, ja que és un problema de classificació binaria.
Els dos grups a comparar seran els registres amb output o target 0 i els registres amb output o target 1.

És a dir, volem trobar diferències rellevants que indiquin quines són les característiques que fan a un registre
pertanyer a un dels dos grups.

Com a metodes d'analisis, farem servir correlacions entre les variables dels dos grups i comparació entre elles,
contrast d'hipotesis entre les característiques dels dos grups i com a últim metode també farem servir
un arbre de decisions del estil XGBoost per tal de extreure explicabilitat a les variables i coneixer
les diferents regles que porten a pertanyer a un grup o un altre, també n'extraurem la importància de les variables en el resultat.

4.2.

Faig els test per cada variable i cada grup al codi, exposo aquí les conclusions.
Mencionar que testejar la normalitat i la homogeneitat de la variancia entre dos grups només es posible per variables
continues, per tant hem de deixar les variables categoriques fora(per molt que estiguin en format númeric),
si volguessim fer algun test sobre aquestes podríem fer un chi quadrat entre les variables target i la categorica en concret.
Com que no es demana a l'enunciat em limito a fer-ho sobre les continues.
Aplico un test de shapiro per la normalitat i un test de levene per l'homogeneitat de variànces.
Les conclusions són:

	- Variable age pel grup 0 no segueix una distribució normal.
	- Variable trtbps pel grup 0 no segueix una distribució normal.
	- Variable thalachh pel grup 1 no segueix una distribució normal.
	- Variable oldpeak, cap d'ambdós grups segueix una distribució normal.
	- Variable age no compta amb homogeneitat de variànces entre els grups.
	- Variable oldpeak no compta amb homogeneitat de variànces entre els grups.
	- Tot el no mencionat en aquesta llista segueix una distribució normal i té homogeneitat de variànces entre els grups.


4.3.

En aquest apartat en el codi realitzem correlacions per les variables continues, correlacions estandard i podem observar que pel grup 0(target=0) no hi cap correlació rellevant totes estan properes a 0.
Pel grup 1(target=1), tenim una correlació rellevant thalachh i age. Thalach es el rati maxim de frequencia cardiaca assolit i age l'edat. Aquesta correlació és normal i lògica.
A major edat, menor frequència cardíaca i viceversa. De fet això esta modelat per la formula MHR=220−Age. Per tant es una bona troballa i es un fet lògic.
Duc a terme correlacions per les variables categoriques, em baso en la v de cramer que es basa en el test de chi**2.
Podem veure una correlació entre exng i cp pel grup 0 i un altre correlació pel grup 1 entre sex i thall. La veritat no acabo d'entendre molt be la relació lògica que poden tindre, a més els valors no superen els 0.4 per
tant realment no són massa rellevants.

Posteriorment realitzo 2 test d'hipotesis:
El primer sobre la variable cholesterol, el que esperem es que el colesterol sigui major per el grup 1 que el 0, però el que comprovem realment es que hi hagi una diferència significativa entre ambdos grups.
La hipotesis nula es que aquesta diferencia no existeix. La proba dona un resultat de P-value 0.06, amb un 5% de significació no podriem refutar.
Per tant no podem assumir que hi hagi una diferència, a més a més si veiem les mitjanes per ambdos grups veurem que el grup 1 té una menor tasa de colesterol que el grup 0 cosa bastant curiosa.

El segon test d'hipotesis, comprova si hi ha una difèrencia d'edat entre amdos grups, esperariem que el grup 1 tingui major edat.
La hipòtesi nula assumeix que aquesta difèrencia no existeix. El test retorna aquest valor P-value 8.928754006912085e-05. És a dir, si hi ha una diferència significativa entre els grups en la variable edat.
A més a més novament tenim sorpresa, al veure que la mitja del grup zero es major que la del grup 1, just el contrari del que pensariem que passaria.

Per últim entreno un XGBoost, mostro el conjunt de regles que el model retorna però són díficils de comprendre, faig un SHAP pel conjunt de test, i veiem que per exemple la variable sex quan ajuda al output a ser 0 té molta feature importance
mentre que quan ajuda a ser 1, té molt poca feature importance. Passa el mateix amb exang i el contrari amb slp. El model entrenat retorna un accuracy del 84% i un GINI del 85% valors prou bons.
Per últim realitzo també una regressió logística:

D'aquesta trec les seguents conclusions:
	- El fet que la variable sex sigui 1(home) fa que la probabilitat disminueixi.
	- El fet que cp sigui 1 o 2 augmenta molt la probabilitat respecte a que sigui cp 0.
	- El fet que restecg sigui 1 augmenta molt la probabilitat de target positiu respecte a que sigui 0 la mateix variable(restecg).
	- exng 1 disminueix la probabilitat respecte a exng 0.
	- Tots els valors de caa disminueixen la probabilitat respecte a que sigui 0, menys el 4.
	- thall 2 augmenta molt la probabilitat i thall 3 la disminueix respecte a thall 0.
	- Age i colesterol no tenen quasi influencia en l'output.
	- La variable sex_1 és molt rellevant.
	- Cp2 i cp3 també ho són.
	- Caa1, 2 i 3 també
	- Age i cholesterol no són rellevants.
El model retorna un accuracy del 88%.

5.
Totes les representacions es presenten al jupyter notebook que aportaro al repositori:
https://github.com/zetag33/heart_attack/

6. Resolució del problema.

La primera conclusió que trec és que les conclusions d'aquest estudi probablement no es puguin aplicar a la població general, ja que el dataset esta "cherry-picked" i el target no reflexa la realitat, per tant podem tindre una concentració de 
positius al target que simplement són persones amb problemes congenits o casos particulars que s'han juntat per tal de poder tindre un target balancejat.

Dit això, per les proves realitzades les conlcusions principals són:
	- No hi ha correlacions significatives entre les variables en cap d'ambdós grups.
	- El grup 1 no sembla tindre ni més edat ni més colesterol( més aviat el contrati, en té menys)
	- Ser home, disminueix la probabilitat de tindre un target 1, respecte a ser dona.
	- Age i colesterol no tenen influencia en l'output, no són rellevants.
	- Els principals factors en que l'output sigui 1, són restecg  = 1, cp = 1 o 2 augmenta molt la probabilitat.
	- exng 0 també augmenta molt la probabilitat, també ho fa thall 2 i thall 3.
	- La variable sex quan ajuda al output a ser 0 té molta feature importance quan ajuda a ser 1 no en té tanta. (SHAP).
	- El dataset es processa facilment i els algoritmes l'entenen correctament i retornen bons resultats tant de GINI com en accuracy.
	- Els resultats permeten respondre ampliament al problema, però novament els resultats es centren en aquest dataset, la realitat dubto molt que s'assembli als resultats que s'obtenen del dataset, ja que el dataset no la reflexa.

7.

El codi es troba al repositori:
https://github.com/zetag33/heart_attack/

8.

Enllaç del video:


